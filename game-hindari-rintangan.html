<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Game Hindari Rintangan</title>
    <style>
        body {
            margin: 0;
            background: #111;
            color: white;
            font-family: sans-serif;
            overflow: hidden;
        }

        #game {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #222;
            overflow: hidden;
        }

        .player {
            position: absolute;
            bottom: 50px;
            left: 100px;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #1e90ff, #00bfff);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #ffffff;
        }

        .player::before {
            content: 'üèÉ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
        }

        .obstacle {
            position: absolute;
            bottom: 50px;
            width: 40px;
            height: 40px;
            background: crimson;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .obstacle.spike {
            background: linear-gradient(45deg, #ff4757, #ff3742);
            border-radius: 50% 50% 0 0;
            height: 50px;
            width: 35px;
        }

        .obstacle.rock {
            background: linear-gradient(45deg, #8b4513, #a0522d);
            border-radius: 15px;
            height: 45px;
            width: 45px;
        }

        .obstacle.cactus {
            background: linear-gradient(45deg, #228b22, #32cd32);
            border-radius: 5px;
            height: 60px;
            width: 30px;
        }

        .obstacle.fire {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            border-radius: 50%;
            height: 35px;
            width: 35px;
            animation: flicker 0.5s infinite alternate;
        }

        @keyframes flicker {
            0% {
                transform: scale(1);
            }

            100% {
                transform: scale(1.1);
            }
        }

        #status {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            font-weight: bold;
        }

        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        #overlay button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div id="game">
        <div id="status">Skor: 0 | Highscore: 0</div>
        <div id="overlay">
            <div id="message">Klik untuk mulai!</div>
            <button onclick="startGame()">Mulai</button>
            <button onclick="window.location.href='index.html'" style="background: #666; margin-top: 10px;">Kembali ke
                Menu</button>
        </div>
    </div>

    <script>
        const game = document.getElementById("game");
        const statusText = document.getElementById("status");
        const overlay = document.getElementById("overlay");
        const message = document.getElementById("message");

        let player, obstacles = [];
        let score = 0;
        let highscore = localStorage.getItem("jump_highscore") || 0;
        let gameOver = true;
        let velocityY = 0;
        const gravity = 0.8;
        let ground = 50;
        let obstacleSpeed = 6;
        let speedIncrease = 0.02;
        let lastObstacleTime = 0;
        let minObstacleInterval = 1500; // 1.5 detik minimum jeda
        let obstacleSpawnRate = 0.008; // Lebih rendah dari sebelumnya

        // Tampilkan highscore saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function () {
            statusText.textContent = `Skor: ${score} | Highscore: ${highscore}`;
        });

        function createPlayer() {
            player = document.createElement("div");
            player.className = "player";
            player.x = 100;
            player.y = ground;
            player.style.bottom = player.y + "px";
            game.appendChild(player);
        }

        function createObstacle() {
            const currentTime = Date.now();

            // Cek apakah sudah cukup jeda dari obstacle terakhir
            if (currentTime - lastObstacleTime < minObstacleInterval) {
                return;
            }

            // Cek jarak minimum dengan obstacle lain
            const minDistance = 200; // Jarak minimum antar obstacle
            const tooClose = obstacles.some(obstacle =>
                obstacle.x > window.innerWidth - minDistance
            );

            if (tooClose) {
                return;
            }

            const obstacle = document.createElement("div");
            obstacle.className = "obstacle";

            // Pilih jenis obstacle secara random
            const obstacleTypes = ['spike', 'rock', 'cactus', 'fire'];
            const randomType = obstacleTypes[Math.floor(Math.random() * obstacleTypes.length)];
            obstacle.classList.add(randomType);

            obstacle.x = window.innerWidth;
            obstacle.style.left = obstacle.x + "px";
            game.appendChild(obstacle);
            obstacles.push(obstacle);

            lastObstacleTime = currentTime;
        }

        function update() {
            if (gameOver) return;

            // lompat & gravitasi
            player.y += velocityY;
            velocityY -= gravity;
            if (player.y < ground) {
                player.y = ground;
                velocityY = 0;
            }
            player.style.bottom = player.y + "px";

            // gerakin rintangan
            obstacles.forEach((obs, i) => {
                obs.x -= obstacleSpeed;
                obs.style.left = obs.x + "px";

                const playerRect = player.getBoundingClientRect();
                const obsRect = obs.getBoundingClientRect();

                // cek tabrakan
                if (
                    playerRect.right > obsRect.left &&
                    playerRect.left < obsRect.right &&
                    playerRect.bottom > obsRect.top
                ) {
                    endGame();
                }

                // sudah lewat layar ‚Üí hapus
                if (obs.x + 40 < 0) {
                    game.removeChild(obs);
                    obstacles.splice(i, 1);
                    score++;

                    // Tingkatkan kesulitan secara gradual
                    obstacleSpeed += speedIncrease;
                    obstacleSpawnRate += 0.0005; // Tingkatkan spawn rate sedikit
                    if (minObstacleInterval > 800) {
                        minObstacleInterval -= 10; // Kurangi interval sedikit
                    }

                    statusText.textContent = `Skor: ${score} | Highscore: ${highscore}`;
                }
            });

            // spawn obstacle dengan sistem yang lebih terkontrol
            if (Math.random() < obstacleSpawnRate) {
                createObstacle();
            }

            requestAnimationFrame(update);
        }

        function jump() {
            if (gameOver) return;
            if (player.y === ground) {
                velocityY = 15;
            }
        }

        function endGame() {
            gameOver = true;
            obstacles.forEach(obs => game.removeChild(obs));
            obstacles = [];
            if (score > highscore) {
                highscore = score;
                localStorage.setItem("jump_highscore", highscore);
            }
            message.textContent = `Game Over! Skor: ${score} | Highscore: ${highscore}`;
            overlay.style.display = "flex";

            // Tambahkan tombol main lagi
            const oldButton = overlay.querySelector("button[onclick='startGame()']");
            if (oldButton) {
                oldButton.textContent = "Main Lagi";
            }
        }

        function startGame() {
            overlay.style.display = "none";
            score = 0;
            obstacleSpeed = 6; // Reset kecepatan rintangan
            obstacleSpawnRate = 0.008; // Reset spawn rate
            minObstacleInterval = 1500; // Reset interval
            lastObstacleTime = 0; // Reset timer
            statusText.textContent = `Skor: ${score} | Highscore: ${highscore}`;
            gameOver = false;
            if (player) game.removeChild(player);
            createPlayer();
            obstacles.forEach(obs => game.removeChild(obs));
            obstacles = [];
            update();
        }

        // kontrol keyboard
        document.addEventListener("keydown", (e) => {
            if (e.code === "Space") jump();
        });
    </script>
</body>

</html>